---
title: è¿”å›é›†æˆå“åº”
url: https://www.yuque.com/mlgrgm/lrf0ra/gophfe
---

ä»€ä¹ˆæ˜¯é›†æˆå“åº”? åœ¨ä½ çš„ä¸šåŠ¡ä¸­è‚¯å®šä¼šéœ€è¦è‡ªå®šä¹‰çŠ¶æ€ç , headersè¿”å›å¤´, åœ¨ä¼ ç»Ÿçš„nodejså¼€å‘ä¸­,æ¯”å¦‚koaä¸­æ˜¯è¿™æ ·å†™çš„:

```typescript
response.body = {
  ...
}
```

é‚£ä¹ˆåŒæ ·çš„, swordé›†æˆå“åº”å¯ä»¥è½»æ¾çš„å¸®ä½ å®Œæˆè¿™ä¸ªéœ€æ±‚, æ‰€ä»¥æˆ‘ä»¬åœ¨useApiä¸­æ–°å¢äº†ä¸€ä¸ªç‰¹æ€§:

```typescript
import { useApi } from '@swordjs/sword-framework';
import { ReqQuery, ReqParams, Res } from './proto';

export default useApi<{
  query: ReqQuery;
  params: ReqParams;
  res: Res;
}>({
  handler: async (ctx) => {
    return () => ({
        statusCode: 200,
        statusMessage: 'success',
        headers: {},
        data: {
          message: 'Hello, World!'
        }
     });
    }
  });
```

runtimeä¼šæ£€æŸ¥ä½ çš„è¿”å›å€¼, å¦‚æœæ˜¯å‡½æ•°, ä½ åœ¨IDEä¸­ä¸ä»…ä¼šè·å¾—ç±»å‹æç¤º, è¿˜ä¼šè¿”å›é›†æˆå“åº”, æ„å‘³ç€ä½ ä¸éœ€è¦ä»»ä½•å­¦ä¹ æˆæœ¬, åªéœ€è¦æ›´æ”¹ä¸ºå‡½æ•°è¿”å›å€¼å°±å¯ä»¥äº†ğŸ˜„ !
useApiè¿”å›å‡½æ•°çš„è¿”å›å€¼ç±»å‹å¦‚ä¸‹:

```typescript
export type CustomHandlerReturn<D = any> = () => {
  statusCode?: number;
  statusMessage?: string;
  data?: UnPromisify<D>;
  headers?: Record<string, string>;
};
```

æˆ‘ä»¬å¯ä»¥æŒ‡å®š, çŠ¶æ€ç ç­‰ç­‰ä¿¡æ¯, éƒ½æ˜¯å¯é€‰çš„, éƒ½æœ‰ä¸€ä¸ªå®‰å…¨çš„é»˜è®¤å€¼:

| statusCode | é»˜è®¤å€¼: 200 |
| --- | --- |
| statusMessage | é»˜è®¤å€¼: "" |
| data | é»˜è®¤å€¼: {} |
| headers | é»˜è®¤å€¼: {} |

<a name="vJTzJ"></a>

## å¹³å°å·®å¼‚

é›†æˆå“åº”åœ¨ä¸åŒçš„å¹³å°è¡¨ç°æ˜¯ä¸€æ ·çš„, é¦–å…ˆé›†æˆå“åº”çš„è®¾è®¡æ˜¯å‚ç…§äº†h3çš„errorè®¾è®¡ (å³serverç«¯), å®ƒçš„æ•°æ®ç»“æ„æ˜¯è¿™æ ·çš„:

```json
{
  statusCode: 404,
  statusMessage: "not found",
  stack: []
}
```

åˆ¤æ–­å½“å‰çš„statusCodeæ˜¯å¦æ˜¯2xx, å¦‚æœä¸æ˜¯2xxä¼šç›´æ¥è§¦å‘æœåŠ¡å™¨é”™è¯¯, å¹¶ä¸”ä½ æŒ‡å®šçš„statusMessageå’Œdataéƒ½ä¼šè¢«è¿”å›; åä¹‹å°†ä¼šç›´æ¥è¿”å›dataä¸­çš„å†…å®¹ <a name="cx4Bm"></a>

### server

```json
export default useApi<{
  query: ReqQuery;
  params: ReqParams;
  res: Res;
}>({
  handler: async (ctx) => {
    return () => ({
        statusCode: 404,
        statusMessage: 'custom error',
        headers: {
          foo: '666'
        },
        data: {
          message: 'Hello, World!'
        }
      })
    }
});

```

![image.png](../assets/gophfe/1656055006250-6cb2081a-ba6f-40c9-b4b0-62350a6867fa.png)

å¦‚æœå½“å‰æ˜¯2xx:

```json
{
    "message": "Hello, World!"
}
```

<a name="tdX2w"></a>

### unicloud

unicloudå¹³å°åˆ†ä¸ºåº”ç”¨å†…è°ƒç”¨å’Œäº‘å‡½æ•°urlåŒ–, åº”ç”¨å†…è°ƒç”¨å’Œserverç«¯æ— å¼‚, ä½†æ˜¯åœ¨äº‘å‡½æ•°urlåŒ–ä¸­, swordåšäº†ä¸€äº›ç‰¹æ®Šçš„å¤„ç† <a name="Sq194"></a>

#### äº‘å‡½æ•°urlåŒ–

æ¡†æ¶ä¼šè¿”å›ä¸€ä¸ª[unicloudçš„é›†æˆå“åº”](https://uniapp.dcloud.io/uniCloud/http.html#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4), æ•°æ®ç»“æ„å¦‚ä¸‹, ä½ åœ¨ä¸šåŠ¡ä¸­æ— éœ€å…³å¿ƒ:

```json
{
  mpserverlessComposedResponse: true, // ä½¿ç”¨é˜¿é‡Œäº‘è¿”å›é›†æˆå“åº”æ˜¯éœ€è¦æ­¤å­—æ®µä¸ºtrue
  isBase64Encoded: false, // ç¡¬ç¼–ç 
  statusCode: customResult.statusCode,
  body: result,
  headers: customResult.headers
};
```

<a name="yM1vs"></a>

## æ³¨æ„äº‹é¡¹

- å¦‚æœçŠ¶æ€ç è¿”å›204, å¦‚æœåœ¨httpç¯å¢ƒ, å°†ä¸ä¼šæ˜¾ç¤ºä»»ä½•dataå†…å®¹, ä½†æ˜¯headersæ˜¯æ­£å¸¸çš„.
